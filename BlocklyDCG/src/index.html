<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="apple-touch-icon" href="apple-touch-icon.png">
        <!-- Place favicon.ico in the root directory -->

        <link rel="stylesheet" href="css/normalize.css">
        <link rel="stylesheet" href="css/main.css">
        <script src="js/vendor/modernizr-2.8.3.min.js"></script>

        <!-- blockly scripts -->
        <script src="blockly/blockly_uncompressed.js"></script>

        <!-- generator script -->
        <script src="blockly/generators/dcg.js"></script>

        <!-- blockly language -->
        <script src="blockly/msg/js/nl.js"></script>
        <script src="blockly/blocks/eval.js"></script>
        <script src="blockly/blocks/comment.js"></script>

        <script src="blockly/blocks/logic.js"></script>
        <script src="blockly/blocks/loops.js"></script>
        <script src="blockly/blocks/math.js"></script>
        <script src="blockly/blocks/text.js"></script>
        <script src="blockly/blocks/lists.js"></script>
        <script src="blockly/blocks/variables.js"></script>
        <script src="blockly/blocks/procedures.js"></script>
        <script src="blockly/blocks/html.js"></script>
        <script src="blockly/blocks/lists.js"></script>


        <!-- python examples -->
        <script src="blockly/generators/python/text.js"></script>
        <script src="blockly/generators/python/variables.js"></script>


        <!-- dcg examples -->
        <script src="blockly/generators/dcg/text.js"></script>
        <script src="blockly/generators/dcg/variables.js"></script>
        <script src="blockly/generators/dcg/eval.js"></script>
        <script src="blockly/generators/dcg/logic.js"></script>
        <script src="blockly/generators/dcg/comment.js"></script>
        <script src="blockly/generators/dcg/html.js"></script>
        <script src="blockly/generators/dcg/lists.js"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.6/ace.js"></script>

        <style>
            html, body {
                height: 100%;
                margin: 0;
            }
            body {
                font-family: sans-serif;
                overflow: hidden;
            }
            h1 {
                font-weight: normal;
                font-size: 140%;
            }
            table {
                background-color: #fdf6e3;
                height: 100%;
                width: 100%;
            }
            #blocklyArea {
                height: 99%;
            }

            #ruletext{
                width: 100%;
                height: 100%;
                background-color: #002b36;
                color: #93a1a1 ;
                font-size: 24px;
            }
        </style>

    </head>
    <body>


    <!--
    HTML XML
    <xml xmlns="http://www.w3.org/1999/xhtml"><block type="html_start" id="G;~vs2*e{$Phbfm(S=rq" x="297" y="210"><mutation items="5"></mutation><value name="ADD0"><block type="html_header" id="s$^~3@R3R8mB:MDn:*os"><field name="LVL">1</field><value name="A"><block type="text" id=";IXIJ7K$8tAP:fb|f3|3"><field name="TEXT">Testen met lijstjes</field></block></value></block></value><value name="ADD1"><block type="html_header" id="eH24P5~0|3rWs[409)Vq"><field name="LVL">4</field><value name="A"><block type="text" id="33$)Bd7^|^nRO/MzAt+:"><field name="TEXT">Ongenummerde lijst</field></block></value></block></value><value name="ADD2"><block type="html_list_unnumbered" id="3OnQ.{IVhlBK/~aM{6~)"><mutation items="3"></mutation><value name="ADD0"><block type="html_bold" id="*#evVy{f{BAybr}NervB"><value name="TEXT"><block type="text" id="*sTVN3xHOT}F5Z:%yB3t"><field name="TEXT">Vet</field></block></value></block></value><value name="ADD1"><block type="html_italic" id="C3Jewck/1G7I=c9VOIsH"><value name="TEXT"><block type="text" id="RB?fa)$([lX7fTg#Rz;g"><field name="TEXT">Cursief</field></block></value></block></value><value name="ADD2"><block type="html_underline" id="u/y(yJp?EmfWVbU-Y?NB"><value name="TEXT"><block type="text" id="970LI,[`6=47ke5jv}_x"><field name="TEXT">Onderlijnt</field></block></value></block></value></block></value><value name="ADD3"><block type="html_header" id="On,vv0;.,DmNQ|K03*g9"><field name="LVL">4</field><value name="A"><block type="text" id="r]b:c(#S4xq2[eABeP2G"><field name="TEXT">Genummerde lijst</field></block></value></block></value><value name="ADD4"><block type="html_list_numbered" id="#Wn0.;{4TY6o{Loq.j5c"><mutation items="3"></mutation><value name="ADD0"><block type="text" id="^VU)2iwqq8Dp{W+jmE@r"><field name="TEXT">One</field></block></value><value name="ADD1"><block type="text" id="vF]}P5L-9-vB@6Mv[e$~"><field name="TEXT">Two</field></block></value><value name="ADD2"><block type="text" id="#@NWXp}Z|q.%Fk~fWX96"><field name="TEXT">Three</field></block></value></block></value></block></xml>


    -->

        <!-- Add your site or application content here -->
        <!--<p>DCG editor</p>-->

        <table>
            <tr>
                <td>
                    <h1> DCG Editor met <a href="https://developers.google.com/blockly/"> BlockLy </a> PoC </h1>
                    <a href="dcgtoblockly.html">DCG to blockly</a>
                <button onclick="saveWorkspace()"> Save </button>
                <button onclick="loadFromXML()"> Load </button>
            </tr>
            <tr>
                <td id="blocklyArea" style="width: 60%">
                </td>
                <td id="editorArea" style="width: 40%; height:100%">
                    <div id="editorAreaDiv" style="width: 100%; height: 50%">
                        <textarea id="ruletext">
                        </textarea>
                    </div>
                    <div id="htmlPreviewDiv" style="width: 100%; height:50%; background-color: #99c0ff; font-size: 20px;">

                    </div>
                </td>
            </tr>
        </table>

        <div id="blocklyDiv" style="position: absolute"></div>

        <xml id="toolbox" style="display: none">

            <category name="Logica">
                <block type="controls_if"></block>
                <block type="logic_compare"></block>
                <block type="logic_operation"></block>
            </category>
            <!--<block type="logic_compare"></block>-->
            <!--<block type="controls_repeat_ext"></block>-->
            <!-- <block type="math_number"></block> -->
            <!--<block type="math_arithmetic"></block>-->
            <category name="Text">
                <block type="text"></block>
                <block type="text_append"></block>
                <block type="text_print"></block>
                <block type="text_isEmpty"></block>
            </category>

            <category name="Varia">
                <block type="eval"></block>
                <block type="singleComment"></block>
                <block type="lists_create_with"></block>
            </category>

            <category name="Variabelen">
                <block type="variables_set"></block>
                <block type="variables_get"></block>
            </category>

            <category name="HTML"> <!-- todo: rename to layout or something similar -->
                <block type="html_start"></block>
                <block type="html_header"></block>
                <block type="html_bold"></block>
                <block type="html_italic"></block>
                <block type="html_underline"></block>
                <block type="html_break"></block>
                <block type="html_list_numbered"></block>
                <block type="html_list_unnumbered"></block>
            </category>

            <category name="Lijsten">
                <block type="lists_create_with"></block>
                <block type="variable_in_list"></block>
                <block type="list_contains_variable"></block>
            </category>
        </xml>


        <script>
            var blocklyArea = document.getElementById('blocklyArea');
            var blocklyDiv = document.getElementById('blocklyDiv');
            var workspace = Blockly.inject(blocklyDiv,
                {media: 'blockly/media/',
                    toolbox: document.getElementById('toolbox')});
            var onresize = function(e) {
                // Compute the absolute coordinates and dimensions of blocklyArea.
                var element = blocklyArea;
                var x = 0;
                var y = 0;
                do {
                    x += element.offsetLeft;
                    y += element.offsetTop;
                    element = element.offsetParent;
                } while (element);
                // Position blocklyDiv over blocklyArea.
                blocklyDiv.style.left = x + 'px';
                blocklyDiv.style.top = y + 'px';
                blocklyDiv.style.width = blocklyArea.offsetWidth + 'px';
                blocklyDiv.style.height = blocklyArea.offsetHeight + 'px';
            };
            window.addEventListener('resize', onresize, false);
            onresize();
            Blockly.svgResize(workspace);

            function generateCode() {
                var code = "rule TESTRULE{\n"
                code += Blockly.Dcg.workspaceToCode(workspace);
                code += "\n}"
                document.getElementById('ruletext').innerHTML = code;
            }
            setInterval(generateCode, 100);

            function generatePreview(){
                var code = Blockly.Dcg.workspaceToCode(workspace);
                // get the CODE that is HTML.
                var result = code.match("<html>.*<\\/html>"); // first assume there is only one matching element.
                if(result == null) return; // just return because there is no HTML yet.
                result = result[0]
                result = result.substring("<html>".length,result.length - "</html>".length);
                var previewDiv = document.getElementById("htmlPreviewDiv");
                previewDiv.innerHTML = result;
            }
            setInterval(generatePreview, 100);


            function saveWorkspace(){
                var xml = Blockly.Xml.workspaceToDom(workspace);
                var xmlText = Blockly.Xml.domToText(xml);
                console.log(xmlText);
            }

            function loadFromXML(){
                var xml = prompt("xml");
                var dom = Blockly.Xml.textToDom(xml);
                Blockly.mainWorkspace.clear();
                Blockly.Xml.domToWorkspace(Blockly.mainWorkspace, dom);
            }
        </script>

    </body>
</html>
